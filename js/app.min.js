
$(document).ready(function () {
$('.good__link').slick({
 dots: true
}
);

});

let hash = location.hash.substring(1);

const getData = async (server) => {
  const data = await fetch(server);

  if (data.ok) {
    return data.json()
  } else {
    throw new Error(`Данные не были получены, ошибка ${data.status} ${data.statusText}`)
  }
};

const getGoods = (callback, value) => {
  getData('db.json')
    .then(data => {
      if (value) {
        callback(data.filter(item => item.category === value))
      } else {
        callback(data);
      }

    })
    .catch(err => {
      console.error(err)
    });
};

try {

  const goodsList = document.querySelector('.goods__list');

  if (!goodsList) {
    throw 'This is not a goods page!'
  }

  const createCard = ({
      id,
      name: title,
      
      cost,
      fstPhoto,
      sndPhoto
      
    }) => {

      const li = document.createElement('li');
      li.classList.add('goods__item');
$(document).ready(function () {
  $('.good__link').slick('slickAdd');
});
      li.innerHTML = `           
            <article class = "good">
              <div class = "good__link">
                <img class = "good__link-img" src = "img/item/${fstPhoto}">
                <img class = "good__link-img" src = "img/item/${sndPhoto}">
              </div> 
              <div class = "good__text">
               <a class = "good__title" href="card-good.html#${id}">${title}</a> 
               <div class = "good__price">${cost}</div> 
              </div>
              <div class = "good__ui">
               <div class = "good__counter"></div> 
               <button class = "good__button">Добавить в корзину</button>
              </div>
             </article>
             
       `;

        return li;
    };

    const renderGoodsList = data => {
        goodsList.textContent = '';

        const arr = data.map(createCard);
        goodsList.append(...arr);
       
    };
    
window.addEventListener('hashchange', () => {
  hash = location.hash.substring(1);
  getGoods(renderGoodsList, hash);
})

getGoods(renderGoodsList, hash);

} catch (err) {
    console.warn(err)
}


function testWebP(callback) {
	var webP = new Image();
	webP.onload = webP.onerror = function () {
		callback(webP.height == 2);
	};
	webP.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
}
testWebP(function (support) {
	if (support == true) {
		document.querySelector('html').classList.add('_webp');
	} else {
		document.querySelector('html').classList.add('_no-webp');
	}
});


$(document).ready(function () {
	$('.menu-burger').click(function (event) {
		$('.menu-burger-content').toggleClass('active');

	});
	$('.menu-burger-close, .menu-burger-list').click(function (event) {
		$('.menu-burger-content').removeClass('active');
	});
});


